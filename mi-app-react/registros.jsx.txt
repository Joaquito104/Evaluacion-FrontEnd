import { useState, useEffect } from 'react';
import './App.css';

function App() {
  const [material, setMaterial] = useState('');
  const [cantidad, setCantidad] = useState('');
  const [fecha, setFecha] = useState('');
  const [registros, setRegistros] = useState([]);

  useEffect(() => {
    try {
      const storedRegistros = localStorage.getItem('registrosReciclaje');
      if (storedRegistros) {
        setRegistros(JSON.parse(storedRegistros));
      }
    } catch (error) {
      console.error("Error al cargar datos de Local Storage:", error);
    }
  }, []);

  useEffect(() => {
    try {
      localStorage.setItem('registrosReciclaje', JSON.stringify(registros));
    } catch (error) {
      console.error("Error al guardar datos en Local Storage:", error);
    }
  }, [registros]);

  const handleSubmit = (e) => {
    e.preventDefault();

    if (!material || !cantidad || !fecha || parseFloat(cantidad) <= 0) {
      alert('Por favor, completa todos los campos correctamente. La cantidad debe ser un número positivo.');
      return;
    }

    const nuevoRegistro = {
      id: Date.now(),
      material,
      cantidad: parseFloat(cantidad),
      fecha,
    };

    setRegistros((prevRegistros) => [...prevRegistros, nuevoRegistro]);

    setMaterial('');
    setCantidad('');
    setFecha('');
  };

  return (
    <div className="app-container">
      <h1>Gestión de Reciclaje en Hogares</h1>

      <section className="registro-form">
        <h2>Registrar Nuevo Reciclaje</h2>
        <form onSubmit={handleSubmit}>
          <label htmlFor="material">Tipo de Material:</label>
          <select
            id="material"
            name="material"
            value={material}
            onChange={(e) => setMaterial(e.target.value)}
          >
            <option value="">Selecciona un material</option>
            <option value="plastico">Plástico</option>
            <option value="papel">Papel</option>
            <option value="vidrio">Vidrio</option>
            <option value="metal">Metal</option>
            <option value="organico">Orgánico</option>
            <option value="otro">Otro</option>
          </select>

          <label htmlFor="cantidad">Cantidad Estimada (kg/unidades):</label>
          <input
            type="number"
            id="cantidad"
            name="cantidad"
            min="0"
            step="0.1"
            value={cantidad}
            onChange={(e) => setCantidad(e.target.value)}
            placeholder="Ej: 1.5"
          />

          <label htmlFor="fecha">Fecha:</label>
          <input
            type="date"
            id="fecha"
            name="fecha"
            value={fecha}
            onChange={(e) => setFecha(e.target.value)}
          />

          <button type="submit">Agregar Registro</button>
        </form>
      </section>

      <section className="lista-registros">
        <h2>Mis Registros de Reciclaje</h2>
        {registros.length === 0 ? (
          <p>Aún no hay registros. ¡Empieza a reciclar!</p>
        ) : (
          <ul>
            {registros.map((registro) => (
              <li key={registro.id}>
                Material: {registro.material}, Cantidad: {registro.cantidad} kg, Fecha: {registro.fecha}
              </li>
            ))}
          </ul>
        )}
      </section>

      <section className="estadisticas">
        <h2>Estadísticas de Reciclaje</h2>
        <p>Las estadísticas y gráficos se mostrarán aquí en futuros pasos.</p>
      </section>
    </div>
  );
}

export default App;